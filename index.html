<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Super Pilot: Nuke Update</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif; touch-action: none; }
        #game-container { position: relative; overflow: hidden; border: 2px solid #222; background: #000; width: 450px; height: 800px; }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* UI å±¤ */
        #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; color: white; }
        .hud-text { padding: 15px; font-weight: bold; text-shadow: 2px 2px #000; font-size: 18px; }
        
        /* æ ¸å½ˆæŒ‰éˆ•å®¹å™¨ */
        #nuke-container { position: absolute; top: 20px; right: 20px; display: flex; gap: 10px; pointer-events: auto; }
        
        /* æ”¹ç”¨åœ–ç‰‡çš„æ ¸å½ˆæŒ‰éˆ• */
        .nuke-btn { 
            width: 50px; height: 50px; 
            background-image: url('rocket_icon.png'); /* è®€å–ä½ çš„ç«ç®­åœ–ç¤º */
            background-size: cover;
            border-radius: 50%; border: 2px solid #fff; cursor: pointer; 
            box-shadow: 0 0 10px #f00; 
            transition: transform 0.1s;
        }
        /* å¦‚æœé‚„æ²’ç”Ÿæˆåœ–ç‰‡ï¼Œé€™è¡Œæœƒæä¾›ä¸€å€‹é è¨­çš„ç«ç®­ Emoji */
        .nuke-btn:after { content: 'ğŸš€'; font-size: 30px; display: flex; justify-content: center; align-items: center; width: 100%; height: 100%; background: radial-gradient(#444, #000); border-radius: 50%; z-index:-1; }
        
        .nuke-btn:active { transform: scale(0.9); }
        
        /* çˆ†ç‚¸ GIF è¦†è“‹å±¤ (é è¨­éš±è—) */
        #vfx-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; pointer-events: none; z-index: 50;
            mix-blend-mode: screen; /* é€™è¡Œå¯ä»¥æŠŠé»‘è‰²èƒŒæ™¯æ¿¾æ‰ï¼Œåªç•™ä¸‹å…‰äº® */
        }
        #vfx-layer img { width: 100%; height: 100%; object-fit: cover; }

        /* ç™½å…‰é–ƒçˆå±¤ */
        #flash-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; opacity: 0; pointer-events: none; z-index: 60;
            transition: opacity 0.1s;
        }

        #boss-hp-bar { display: none; position: absolute; top: 90px; left: 10%; width: 80%; height: 20px; background: #222; border: 3px solid #555; border-radius: 10px; overflow: hidden; box-shadow: 0 0 10px #f00; }
        #boss-hp-inner { width: 100%; height: 100%; background: linear-gradient(to right, #f00, #ff5e00); transition: width 0.1s; }
        
        /* è®€å–ç•«é¢ */
        #loading-screen { position: absolute; top:0; left:0; width:100%; height:100%; background:#000; color:#fff; display:flex; justify-content:center; align-items:center; font-size:24px; z-index: 100; flex-direction: column;}
    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas" width="450" height="800"></canvas>
        
        <div id="vfx-layer"><img id="nuke-gif" src="" alt=""></div>
        <div id="flash-layer"></div>

        <div id="ui">
            <div class="hud-text">
                <span style="color:#0ff">TIME: <span id="timer">120</span>s</span>
            </div>
            <div id="nuke-container">
                </div>
            <div id="boss-hp-bar"><div id="boss-hp-inner"></div></div>
        </div>
        
        <div id="loading-screen">
            <div>LOADING... <span id="loading-percent">0%</span></div>
        </div>
    </div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const ui = {
    nukeBox: document.getElementById('nuke-container'),
    vfxLayer: document.getElementById('vfx-layer'),
    nukeGif: document.getElementById('nuke-gif'),
    flashLayer: document.getElementById('flash-layer'),
    loading: document.getElementById('loading-screen'),
    loadingPercent: document.getElementById('loading-percent')
};

// === éŠæˆ²ç‹€æ…‹ ===
let gameState = {
    nukes: 3,
    shake: 0, // éœ‡å‹•å¼·åº¦
    enemies: [], // å‡è£æœ‰æ•µäºº
    lastTime: 0
};

// === è³‡æºè¼‰å…¥æ¨¡æ“¬ (è£œå®Œä½ åŸæœ¬è¢«åˆ‡æ–·çš„ç¨‹å¼ç¢¼) ===
const imageSources = {
    // é€™è£¡æ”¾ä½ åŸæœ¬çš„è³‡æºï¼Œæˆ‘å…ˆç°¡åŒ–ä»¥ç¢ºä¿èƒ½è·‘
    player: { src: 'player.png', color: '#00f' },
    bg: { src: 'bg_space.png', color: '#111' }
};

let loadedCount = 0;
const totalAssets = Object.keys(imageSources).length;

function loadAllAssets(callback) {
    // æ¨¡æ“¬è¼‰å…¥éç¨‹
    let progress = 0;
    const interval = setInterval(() => {
        progress += 20;
        ui.loadingPercent.innerText = progress + "%";
        if (progress >= 100) {
            clearInterval(interval);
            ui.loading.style.display = 'none';
            callback();
        }
    }, 100);
}

// === æ ¸å½ˆæ ¸å¿ƒé‚è¼¯ ===
function initNukeUI() {
    ui.nukeBox.innerHTML = '';
    for(let i=0; i<gameState.nukes; i++) {
        const btn = document.createElement('div');
        btn.className = 'nuke-btn';
        btn.onclick = () => triggerNuke(btn);
        ui.nukeBox.appendChild(btn);
    }
}

function triggerNuke(btnElement) {
    if (gameState.nukes <= 0) return;
    
    // 1. æ‰£é™¤æ•¸é‡ & ç§»é™¤ UI
    gameState.nukes--;
    btnElement.style.display = 'none'; // éš±è—é»æ“Šçš„é‚£é¡†

    // 2. å•Ÿå‹•éœ‡å‹• (å¼·åº¦ 20)
    gameState.shake = 30;

    // 3. æ’­æ”¾ç™½å…‰é–ƒçˆ
    ui.flashLayer.style.opacity = 1;
    setTimeout(() => { ui.flashLayer.style.opacity = 0; }, 100);

    // 4. æ’­æ”¾ GIF å‹•ç•«
    // å°æŠ€å·§ï¼šåŠ ä¸Šæ™‚é–“æˆ³è¨˜ (?t=...) å¼·åˆ¶ç€è¦½å™¨é‡æ–°è®€å– GIFï¼Œç¢ºä¿æ¯æ¬¡éƒ½å¾é ­æ’­æ”¾
    ui.nukeGif.src = "nuke_explosion.gif?t=" + new Date().getTime(); 
    ui.vfxLayer.style.display = 'block';

    // 1.5ç§’å¾Œé—œé–‰ GIF (å‡è¨­çˆ†ç‚¸å‹•ç•«ç´„ 1.5ç§’)
    setTimeout(() => {
        ui.vfxLayer.style.display = 'none';
    }, 1500);

    console.log("BOOM! Enemies wiped out.");
    // åœ¨é€™è£¡åŠ å…¥ã€Œæ®ºæ­»æ‰€æœ‰æ•µäººã€çš„é‚è¼¯
    // gameState.enemies = [];
}

// === éŠæˆ²è¿´åœˆ (åŒ…å«éœ‡å‹•æ•ˆæœ) ===
function update(dt) {
    // éœ‡å‹•è¡°æ¸›
    if (gameState.shake > 0) {
        gameState.shake *= 0.9; // æ¯æ¬¡éæ¸› 10%
        if (gameState.shake < 0.5) gameState.shake = 0;
    }
}

function draw() {
    // æ¸…ç©ºç•«é¢
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.save();
    
    // === éœ‡å‹•æ•ˆæœæ ¸å¿ƒ ===
    // åœ¨ç¹ªè£½ä»»ä½•æ±è¥¿ä¹‹å‰ï¼Œå…ˆæ ¹æ“š shake å€¼éš¨æ©Ÿä½ç§»ç•«å¸ƒ
    if (gameState.shake > 0) {
        const dx = (Math.random() - 0.5) * gameState.shake;
        const dy = (Math.random() - 0.5) * gameState.shake;
        ctx.translate(dx, dy);
    }

    // ç•«èƒŒæ™¯ (ç¤ºæ„å¤–ç©º)
    ctx.fillStyle = "#111";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // ç•«ç©å®¶ (ç¤ºæ„)
    ctx.fillStyle = "#0ff";
    ctx.beginPath();
    ctx.moveTo(225, 700);
    ctx.lineTo(205, 740);
    ctx.lineTo(245, 740);
    ctx.fill();

    // ç•«æ•µäºº (ç¤ºæ„)
    ctx.fillStyle = "#f00";
    ctx.fillRect(100, 100, 50, 50);
    ctx.fillRect(300, 200, 50, 50);

    ctx.restore();
}

function gameLoop(timestamp) {
    const dt = timestamp - gameState.lastTime;
    gameState.lastTime = timestamp;

    update(dt);
    draw();

    requestAnimationFrame(gameLoop);
}

// === å•Ÿå‹• ===
loadAllAssets(() => {
    initNukeUI();
    requestAnimationFrame(gameLoop);
});

</script>
</body>
</html>

